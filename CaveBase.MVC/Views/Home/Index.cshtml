@{
    ViewData["Title"] = "Home Page";
}

<h1>Happening right now on CaveBase</h1>
<div id="app">
    <div id="messageList"></div>
</div>

@section scripts {
    <script src="~/js/vue.js"></script>
    <script src="~/lib/signalr/dist/browser/signalr.js"></script>
    <script>

        var app = new Vue({

            el: "#app",

            data: {
                connection: null
            },

            created: function () {
                var self = this;
                self.SetUpSignalR();
            },

            methods: {

                SetUpSignalR: function () {
                    self = this;
                    self.connection = new signalR.HubConnectionBuilder().withUrl("/CaveBaseHub").build();

                    self.connection.on("ReceiveUpdateCountry", function (country, oldcountry, message) {
                        //created li element with correct class
                        var div = document.createElement("div");
                        var pNew = document.createElement("p");
                        var pOld = document.createElement("p");
                        var updateMessage = document.createElement("p");
                        div.className = "updateMessage";

                        //add info about the old country, a br and the new info; received from signal R
                        updateMessage.innerText = message;
                        pNew.innerText = `INTO: ${country.name} (${country.shortName})`;
                        pOld.innerText += `FROM: ${oldcountry.name} (${oldcountry.shortName})`;

                        //wrap in div
                        div.appendChild(updateMessage);
                        div.appendChild(pOld);
                        div.appendChild(pNew);

                        //add to messageList
                        var messageList = document.getElementById("messageList");
                        messageList.insertBefore(div, messageList.childNodes[0]);
                    });

                    self.connection.start().catch(function (err) {
                        return console.error(err.toString());
                    });
                }
            }
        });

    </script>
}
